<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Adjusted Relative Risk and Odds Ratios • SPR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Adjusted Relative Risk and Odds Ratios">
<meta property="og:description" content="SPR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SPR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/a00_Fundamentals.html">Fundamentals</a>
    </li>
    <li>
      <a href="../articles/a01_Continuous.html">Continuous Data (Normal error distribution)</a>
    </li>
    <li>
      <a href="../articles/a02_Binomial.html">Binomial Distribution</a>
    </li>
    <li>
      <a href="../articles/a03_Ordinal_Probit.html">Ordinal Data (Probit)</a>
    </li>
    <li>
      <a href="../articles/a04_Ordinal_Logistic.html">Ordinal Data (Logistic)</a>
    </li>
    <li>
      <a href="../articles/a05_Multinomial.html">Multinomial Distribution</a>
    </li>
    <li>
      <a href="../articles/a06_0_Poisson_Negative_Binomial.html">Poisson and Negative Binomial Distributions</a>
    </li>
    <li>
      <a href="../articles/a06_1_ZIP.html">Zero Inflated Poisson - ZIP</a>
    </li>
    <li>
      <a href="../articles/a06_2_ZINB.html">Zero Inflated Negative Binomial - ZINB</a>
    </li>
    <li>
      <a href="../articles/a07_1_Relative_Risk.html">Relative Risk and Odds Ratios</a>
    </li>
    <li>
      <a href="../articles/a07_2_Relative_Risk_pt2.html">Adjusted Relative Risk and Odds Ratios</a>
    </li>
    <li>
      <a href="../articles/a07_Beta.html">Beta Distribution</a>
    </li>
    <li>
      <a href="../articles/a08_Fit_MMRM_in_R.html">Fit MMRM using R</a>
    </li>
    <li>
      <a href="../articles/a09_MMRM_Sim_Study.html">Simulation Study to Evaluate MMRM Performance</a>
    </li>
    <li>
      <a href="../articles/a10_Missing_Data.html">How to Handle Missing Data</a>
    </li>
    <li>
      <a href="../articles/a11_MCAR_MAR_MNAR.html">Continuation of Missing Data Handling - What is the Relationship Between MCAR/MAR/MNAR?</a>
    </li>
    <li>
      <a href="../articles/a12_MCAR_MAR_CMCAR.html">Continuation of Missing Data Handling: What is the relationship between MCAR/MAR/Conditional MCAR?</a>
    </li>
    <li>
      <a href="../articles/a13_MMRM_vs_Mixed_Effects.html">MMRM and Mixed Effects Model, Simulation Study</a>
    </li>
    <li>
      <a href="../articles/a14_GLMM.html">Longitudinal Binomial Data with the Generalized Linear Mixed Model: Simulation Study</a>
    </li>
    <li>
      <a href="../articles/a15_CLMM_logistic.html">Longitudinal Ordinal Data (Logistic, Marginal)</a>
    </li>
    <li>
      <a href="../articles/a16_CLMM_conditional.html">Longitudinal Ordinal Data, Conditional Specification</a>
    </li>
    <li>
      <a href="../articles/a17_Long_Data_All_Types.html">Longitudinal Data, All Data Types, Conditional Specification</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="a07_2_Relative_Risk_pt2_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Adjusted Relative Risk and Odds Ratios</h1>
            
      
      
      <div class="hidden name"><code>a07_2_Relative_Risk_pt2.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>Now we extend the OR to RR to include covariates. We can do this with categorical covariates or continuous covariates. There is an R packge with a function (<code><a href="https://rdrr.io/pkg/epitools/man/probratio.html">epitools::probratio</a></code>) that will help you do this, but I want to do it by hand so we all understand what is actually happening.</p>
<p>Also note that I recently had to compute the adjusted RR for an ordinal regression model. I couldn’t use an R library, I had to do it by hand. Once you understand this code below, you’ll be able to extend it to ordinal context.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">SPR</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">MASS</a></span><span class="op">)</span>

<span class="va">N</span> <span class="op">=</span> <span class="fl">1e5</span> <span class="co">#this should be divisible by however many groups you use!</span>
<span class="va">number.groups</span> <span class="op">&lt;-</span> <span class="fl">2</span>
<span class="va">number.timepoints</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">9122021</span><span class="op">)</span>

<span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">'USUBJID'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'Subject_'</span>, <span class="fu"><a href="https://rdrr.io/r/base/formatc.html">formatC</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span>, width <span class="op">=</span> <span class="fl">4</span>, flag <span class="op">=</span> <span class="st">'0'</span><span class="op">)</span><span class="op">)</span>, length.out<span class="op">=</span> <span class="va">N</span><span class="op">*</span><span class="va">number.timepoints</span><span class="op">)</span>, <span class="st">'Group'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">'Group_'</span>, <span class="fl">1</span><span class="op">:</span><span class="va">number.groups</span><span class="op">)</span>, length.out <span class="op">=</span> <span class="va">N</span><span class="op">*</span><span class="va">number.timepoints</span><span class="op">)</span>, stringsAsFactors<span class="op">=</span><span class="cn">F</span><span class="op">)</span>

<span class="co"># Generate a Covariate</span>

<span class="co"># Option 1: Continuous, unbalanced:</span>
<span class="co"># dat$Covariate &lt;- rlnorm(n = N, mean = dat$Group == 'Group_2', sd = 0.25)</span>
<span class="co"># range(dat$Covariate)</span>
<span class="co"># aggregate(Covariate  ~ Group, FUN = function(x) round(mean(x, na.rm = T),2), dat = dat, na.action = na.pass)</span>
<span class="co"># Covariate is unbalanced across groups, could serve as a confound</span>

<span class="co"># Option 2: Categorical, Balanced:</span>
<span class="co"># dat$Z &lt;- sample(x = c(0,1), size = N, replace = T, prob = c(0.5, 0.5))</span>

<span class="co"># Option 3: Categorical, Unbalanced:</span>
<span class="va">dat</span><span class="op">$</span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fl">0.4</span> <span class="op">+</span> <span class="fl">0.4</span><span class="op">*</span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">Group</span> <span class="op">==</span> <span class="st">'Group_1'</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">Z</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     0     1 </span>
<span class="co">#&gt; 40063 59937</span>
<span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Group</span> <span class="op">+</span> <span class="va">Z</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span>
<span class="co">#&gt;          Z</span>
<span class="co">#&gt; Group         0     1</span>
<span class="co">#&gt;   Group_1 10033 39967</span>
<span class="co">#&gt;   Group_2 30030 19970</span>


<span class="co"># Create Beta parameters for these design matrix:</span>
<span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">Group</span> <span class="op">+</span> <span class="va">Z</span> , data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span>

<span class="co"># Create Beta</span>
<span class="va">Beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, dimnames<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span>, <span class="st">'param'</span><span class="op">)</span><span class="op">)</span>
<span class="va">Beta</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.25</span>, <span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span><span class="op">)</span>

<span class="co"># Matrix multiply:</span>
<span class="va">XB</span> <span class="op">&lt;-</span> <span class="va">X</span> <span class="op">%*%</span> <span class="va">Beta</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">XB</span><span class="op">)</span> <span class="co"># prevalence - log link</span>
<span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.17 0.78</span>
<span class="co">#p &lt;- exp(XB)/(1 + exp(XB)) - this is the logistic link</span>

<span class="co"># Dichotomize</span>
<span class="va">dat</span><span class="op">$</span><span class="va">Y_binom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="fl">1</span><span class="op">*</span><span class="op">(</span><span class="va">p</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Plot</span>
<span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html">aggregate</a></span><span class="op">(</span><span class="va">Y_binom</span>  <span class="op">~</span> <span class="va">Group</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span>, na.rm <span class="op">=</span> <span class="cn">T</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span>, dat <span class="op">=</span> <span class="va">dat</span>, na.action <span class="op">=</span> <span class="va">na.pass</span><span class="op">)</span>
<span class="co">#&gt;     Group Y_binom</span>
<span class="co">#&gt; 1 Group_1    0.53</span>
<span class="co">#&gt; 2 Group_2    0.24</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/barplot.html">barplot</a></span><span class="op">(</span><span class="fl">100</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">Y_binom</span> <span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">dat</span><span class="op">$</span><span class="va">Y_binom</span> <span class="op">)</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span><span class="op">)</span>, ylab <span class="op">=</span> <span class="st">'Percentage'</span>, col <span class="op">=</span> <span class="st">'grey'</span>, main <span class="op">=</span> <span class="st">'Binomial'</span><span class="op">)</span>


<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></code></pre></div>
<p><img src="a07_2_Relative_Risk_pt2_files/figure-html/sim2-1.png" width="700"></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">Y_binom</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">Group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="op">(</span><span class="va">..count..</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">..count..</span><span class="op">)</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"#e9ecef"</span>, alpha<span class="op">=</span><span class="fl">0.6</span>, position<span class="op">=</span><span class="st">"dodge"</span>, stat<span class="op">=</span><span class="st">"count"</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels<span class="op">=</span><span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html">percent_format</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'Groups'</span>, values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"blue2"</span>, <span class="st">"red2"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">'bottom'</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Score'</span>, y <span class="op">=</span> <span class="st">'Percentage'</span>,
           title <span class="op">=</span> <span class="st">'Scores with a Binomial Distribution'</span>,
           caption <span class="op">=</span> <span class="st">'Note: Simulated data'</span><span class="op">)</span></code></pre></div>
<p><img src="a07_2_Relative_Risk_pt2_files/figure-html/sim2-2.png" width="700"></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Observed Data:</span>
<span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Y_binom</span> <span class="op">+</span> <span class="va">Group</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span>
<span class="co">#&gt;        Group</span>
<span class="co">#&gt; Y_binom Group_1 Group_2</span>
<span class="co">#&gt;       0   23328   37858</span>
<span class="co">#&gt;       1   26672   12142</span>
<span class="va">ptab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/proportions.html">prop.table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/xtabs.html">xtabs</a></span><span class="op">(</span><span class="op">~</span> <span class="va">Y_binom</span> <span class="op">+</span> <span class="va">Group</span>, data <span class="op">=</span> <span class="va">dat</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></code></pre></div>
</div>
<div id="model-fitting---log-binomial" class="section level2">
<h2 class="hasAnchor">
<a href="#model-fitting---log-binomial" class="anchor"></a>Model Fitting - Log Binomial</h2>
<p>This models the relative risk directly.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Compare to model output:</span>
<span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Y_binom</span> <span class="op">~</span> <span class="va">Group</span>, data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span><span class="st">'log'</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Adjusted Relative Risk - log binomial model with covariate (confound)</span>
<span class="va">mod2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Y_binom</span> <span class="op">~</span> <span class="va">Group</span> <span class="op">+</span> <span class="va">Z</span>,
            start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">Beta</span><span class="op">)</span>,
            data <span class="op">=</span> <span class="va">dat</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span><span class="st">'log'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="model-fitting---logistic-regression" class="section level2">
<h2 class="hasAnchor">
<a href="#model-fitting---logistic-regression" class="anchor"></a>Model Fitting - Logistic Regression</h2>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#--------------------------------</span>
<span class="co"># Logistic Regression:</span>
<span class="va">mod.lr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span><span class="op">(</span><span class="va">Y_binom</span> <span class="op">~</span> <span class="va">Group</span> <span class="op">+</span> <span class="va">Z</span>, data <span class="op">=</span> <span class="va">dat</span>,
              family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span><span class="op">(</span>link <span class="op">=</span><span class="st">'logit'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Now we have the odds ratio from the model, we can compute the relative risk using the formula we reviewed: OR/((1-P0) + (P0 * OR)). However, this formula requires the baseline prevalence.</p>
</div>
<div id="recover-adjusted-rr" class="section level2">
<h2 class="hasAnchor">
<a href="#recover-adjusted-rr" class="anchor"></a>Recover adjusted RR</h2>
<p>We want the probability of Y given Group membership, averaged over covariates. This is computing the RR marginalizing over the covariates. So this is the RR specific to the sample characteristics. You’ve selected a base rate specific to the sample.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p1i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod.lr</span>, type <span class="op">=</span> <span class="st">'response'</span>,
              newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">'Group'</span> <span class="op">=</span> <span class="st">'Group_2'</span>,
                                  <span class="st">'Z'</span> <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">Z</span><span class="op">)</span><span class="op">)</span>

<span class="va">p0i</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">mod.lr</span>, type <span class="op">=</span> <span class="st">'response'</span>,
              newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="st">'Group'</span> <span class="op">=</span> <span class="st">'Group_1'</span>,
                                   <span class="st">'Z'</span> <span class="op">=</span> <span class="va">dat</span><span class="op">$</span><span class="va">Z</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">p1i</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">p0i</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.3634829</span>

<span class="co"># This aligns with the generating value:</span>
<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">Beta</span><span class="op">[</span><span class="st">'GroupGroup_2'</span>, <span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.3678794</span></code></pre></div>
<div id="note-on-computation" class="section level3">
<h3 class="hasAnchor">
<a href="#note-on-computation" class="anchor"></a>Note on computation</h3>
<p><a href="https://escholarship.org/content/qt3ng2r0sm/qt3ng2r0sm.pdf" class="uri">https://escholarship.org/content/qt3ng2r0sm/qt3ng2r0sm.pdf</a></p>
<p>“Standardized measures are constructed by taking averages over C before comparisons (e.g., ratios or differences) across X…Recalling Jensen’s inequality (an average of a nonlinear function does not equal the function applied to the averages), it should not be surprising to find divergences between collapsibility conditions depending on the step at which averaging is done (Samuels, 1981, sec. 3).”</p>
</div>
</div>
<div id="r-package-epitools" class="section level2">
<h2 class="hasAnchor">
<a href="#r-package-epitools" class="anchor"></a>R package <code>epitools</code>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">epitools</span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'epitools' was built under R version 4.1.1</span>
<span class="co"># Function is 'probratio()'</span>
<span class="co"># See documentation - marginalizes over observed covariates</span>
<span class="va">pr</span> <span class="op">&lt;-</span> <span class="fu">epitools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/epitools/man/probratio.html">probratio</a></span><span class="op">(</span><span class="va">mod.lr</span>, 
                          method<span class="op">=</span><span class="st">'delta'</span>, 
                          scale<span class="op">=</span><span class="st">'linear'</span><span class="op">)</span> 
<span class="va">pr</span>
<span class="co">#&gt;              Relative risk  Std. Error   Z-value p-value Lower 2.5% CI</span>
<span class="co">#&gt; GroupGroup_2     0.3634829 0.003477571 183.03495       0     0.3566670</span>
<span class="co">#&gt; Z                0.6197400 0.004671086  81.40721       0     0.6105848</span>
<span class="co">#&gt;              Upper 97.5% CI</span>
<span class="co">#&gt; GroupGroup_2      0.3702988</span>
<span class="co">#&gt; Z                 0.6288951</span></code></pre></div>
</div>
<div id="summary---all-the-rr" class="section level2">
<h2 class="hasAnchor">
<a href="#summary---all-the-rr" class="anchor"></a>Summary - All the RR</h2>
<p>Let’s put it all together and see if we can understand</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="co"># Generating parameter (true value):</span>
<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="va">Beta</span><span class="op">[</span><span class="st">'GroupGroup_2'</span>, <span class="op">]</span><span class="op">)</span> 
<span class="co">#&gt; [1] 0.3678794</span>

<span class="co"># Observed RR (just using observed proportions):</span>
<span class="va">ptab</span> <span class="co"># Group 1 &amp; Group 2</span>
<span class="co">#&gt;        Group</span>
<span class="co">#&gt; Y_binom Group_1 Group_2</span>
<span class="co">#&gt;       0 0.46656 0.75716</span>
<span class="co">#&gt;       1 0.53344 0.24284</span>
<span class="va">ptab</span><span class="op">[</span><span class="st">'1'</span>, <span class="st">'Group_2'</span><span class="op">]</span><span class="op">/</span><span class="va">ptab</span><span class="op">[</span><span class="st">'1'</span>, <span class="st">'Group_1'</span><span class="op">]</span> 
<span class="co">#&gt; [1] 0.455234</span>

<span class="co"># RR from unadjusted log-binomial model:</span>
<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span><span class="op">[</span><span class="st">'GroupGroup_2'</span><span class="op">]</span><span class="op">)</span> 
<span class="co">#&gt; GroupGroup_2 </span>
<span class="co">#&gt;     0.455234</span>

<span class="co"># RR from Adjusted log-binomial model</span>
<span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mod2</span><span class="op">)</span><span class="op">[</span><span class="st">'GroupGroup_2'</span><span class="op">]</span><span class="op">)</span> 
<span class="co">#&gt; GroupGroup_2 </span>
<span class="co">#&gt;    0.3699474</span>

<span class="co"># RR from adjusted Logistic Regression - Marginalized over covariates </span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">p1i</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">p0i</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.3634829</span>

<span class="co"># same, but letting `epitools::probratio()` do all the work:</span>
<span class="va">pr</span>
<span class="co">#&gt;              Relative risk  Std. Error   Z-value p-value Lower 2.5% CI</span>
<span class="co">#&gt; GroupGroup_2     0.3634829 0.003477571 183.03495       0     0.3566670</span>
<span class="co">#&gt; Z                0.6197400 0.004671086  81.40721       0     0.6105848</span>
<span class="co">#&gt;              Upper 97.5% CI</span>
<span class="co">#&gt; GroupGroup_2      0.3702988</span>
<span class="co">#&gt; Z                 0.6288951</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Charlie Iaconangelo.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
